# ヘッダーのログアウトボタン統一実装タスク一覧

## 概要
ヘッダーのログアウトボタンと画面内のログアウトボタンの実装を統一するための実装タスク一覧。要件定義書と設計書に基づき、実装可能な粒度でタスクを分解。

## 実装フェーズ

### Phase 1: navbar.tsxの修正

#### - [ ] タスク 1.1: インポートの修正
**目的**: `AuthButtons`コンポーネントをインポートし、不要なインポートを削除する。

**作業内容**:
- `AuthButtons`を`@/components/auth/auth-buttons`からインポート
- `signIn`、`signOut`を`@/auth`からのインポートから削除（他で使用されていないことを確認）
- `Button`を`@/components/ui/button`からのインポートから削除（他で使用されていないことを確認）
- `auth`は`@/auth`からインポートを維持（セッション取得に使用）

**実装コード**:
```tsx
// 変更前
import { auth, signIn, signOut } from "@/auth";
import { Button } from "@/components/ui/button";

// 変更後
import { auth } from "@/auth";
import { AuthButtons } from "@/components/auth/auth-buttons";
```

**確認事項**:
- `AuthButtons`が正しくインポートされている
- `signIn`、`signOut`、`Button`が削除されている（他で使用されていないことを確認）
- `auth`が維持されている
- TypeScriptの型チェックでエラーが発生しない

#### - [ ] タスク 1.2: コンポーネントの置き換え
**目的**: ユーザー情報表示部分とログアウト/ログインボタンを`AuthButtons`コンポーネントに置き換える。

**作業内容**:
- ユーザー情報表示部分（`<div className="flex items-center gap-2">...</div>`）を削除
- ログアウトボタンのform（`<form action={async () => { "use server"; await signOut() }}>...</form>`）を削除
- ログインボタンのform（`<form action={async () => { "use server"; await signIn('auth0') }}>...</form>`）を削除
- `<AuthButtons user={session?.user ?? null} />`を追加

**実装コード**:
```tsx
// 変更前
<div className="flex items-center gap-4">
  {session?.user ? (
    <>
      <div className="flex items-center gap-2">
        <span className="text-sm font-semibold">{session.user.name}</span>
        {session.user.email && (
          <span className="text-xs text-gray-600">{session.user.email}</span>
        )}
      </div>
      <form action={async () => {
        "use server"
        await signOut()
      }}>
        <Button type="submit" variant="outline">ログアウト</Button>
      </form>
    </>
  ) : (
    <form action={async () => {
      "use server"
      await signIn('auth0')
    }}>
      <Button type="submit" aria-label="ナビゲーションバーからログイン">ログイン</Button>
    </form>
  )}
</div>

// 変更後
<div className="flex items-center gap-4">
  <AuthButtons user={session?.user ?? null} />
</div>
```

**確認事項**:
- ユーザー情報表示部分が削除されている
- ログアウトボタンのformが削除されている
- ログインボタンのformが削除されている
- `<AuthButtons user={session?.user ?? null} />`が追加されている
- `session?.user ?? null`の型が`AuthButtons`コンポーネントの`user`プロップの型と一致している
- TypeScriptの型チェックでエラーが発生しない

### Phase 2: 動作確認

#### - [ ] タスク 2.1: ログアウト機能の確認
**目的**: ヘッダーのログアウトボタンが正常に動作することを確認する。

**作業内容**:
- 開発サーバーを起動
- ログイン状態でヘッダーのログアウトボタンをクリック
- ログアウトが正常に実行されることを確認
- ログアウト後に適切なページにリダイレクトされることを確認

**確認事項**:
- ログアウトボタンが表示されている（ログイン状態時）
- ログアウトボタンをクリックするとログアウトが実行される
- ログアウト後に適切なページにリダイレクトされる
- ログアウト後は未ログイン状態として表示される

#### - [ ] タスク 2.2: ログイン機能の確認
**目的**: ヘッダーのログインボタンが正常に動作することを確認する（未ログイン時）。

**作業内容**:
- 開発サーバーを起動
- 未ログイン状態でヘッダーのログインボタンをクリック
- ログインが正常に実行されることを確認
- ログイン後に適切なページにリダイレクトされることを確認

**確認事項**:
- ログインボタンが表示されている（未ログイン時）
- ログインボタンをクリックするとログインが実行される
- ログイン後に適切なページにリダイレクトされる
- ログイン後はログイン状態として表示される

#### - [ ] タスク 2.3: UIデザインの確認
**目的**: 変更後のUIデザインが意図通りに表示されることを確認する。

**作業内容**:
- 開発サーバーを起動
- ログイン状態と未ログイン状態の両方でUIを確認
- レスポンシブレイアウトが正常に動作することを確認（小画面と大画面）
- UIデザインが`AuthButtons`コンポーネントの仕様通りに表示されることを確認

**確認事項**:
- ログイン状態時: ユーザー情報とログアウトボタンが表示される
- 未ログイン時: 「ログインしていません」とログインボタンが表示される
- レスポンシブレイアウトが正常に動作する（小画面では縦並び、大画面では横並び）
- ボタンのスタイルが`variant="destructive" size="sm"`（ログアウト）または`size="sm"`（ログイン）になっている
- UIデザインが画面内のログアウトボタンと完全に同じになっている

**注意事項**:
- UIデザインが崩れる可能性があるが、これは許容する（要件定義書の「UIデザインの調整は範囲外」に従う）
- 完全に同じ実装になることを優先する

### Phase 3: テストの確認と修正

#### - [ ] タスク 3.1: 既存テストの確認
**目的**: 既存のテストが正常に動作することを確認する。

**作業内容**:
- 既存のテストを実行
- テストが失敗する場合は、失敗原因を確認
- navbar.tsxのUI構造に依存するテストを特定
- `signOut`や`signIn`を直接モックしているテストを特定

**確認事項**:
- 既存のテストが正常に動作する
- テストが失敗する場合は、失敗原因が特定されている
- navbar.tsxのUI構造に依存するテストが特定されている
- `signOut`や`signIn`を直接モックしているテストが特定されている

#### - [ ] タスク 3.2: テストの修正（必要に応じて）
**目的**: 失敗したテストを修正する。

**作業内容**:
- navbar.tsxのUI構造に依存するテストを修正
  - `AuthButtons`コンポーネントをモックする
  - または、`AuthButtons`コンポーネントの使用を前提としたテストに変更
- `signOut`や`signIn`を直接モックしているテストを修正
  - `signOutAction`や`signInAction`をモックするように変更
  - または、`AuthButtons`コンポーネントをモックする

**確認事項**:
- 修正したテストが正常に動作する
- すべての既存テストが正常に動作する

**注意事項**:
- テストの修正が必要な場合は、ユーザーに修正内容の許可を取ること（CLAUDE.local.mdのルールに従う）

### Phase 4: 最終確認

#### - [ ] タスク 4.1: 受け入れ基準の確認
**目的**: 要件定義書の受け入れ基準をすべて満たしていることを確認する。

**作業内容**:
- 要件定義書の受け入れ基準（6.1、6.2、6.3、6.4）を確認
- 各項目が満たされていることを確認

**確認事項**:
- 6.1 navbar.tsxの修正: すべての項目が満たされている
- 6.2 実装の統一: すべての項目が満たされている
- 6.3 動作確認: すべての項目が満たされている
- 6.4 コード品質: すべての項目が満たされている

#### - [ ] タスク 4.2: コードレビュー
**目的**: コードの品質を確認する。

**作業内容**:
- 実装の統一性を確認（すべてのログアウトボタンで`AuthButtons`コンポーネントを使用している）
- 不要なインポートやコードが削除されていることを確認
- コードの可読性が向上していることを確認
- TypeScriptの型チェックでエラーが発生しないことを確認

**確認事項**:
- 実装の統一性が保たれている
- 不要なインポートやコードが削除されている
- コードの可読性が向上している
- TypeScriptの型チェックでエラーが発生しない

## 実装順序

1. Phase 1: navbar.tsxの修正
   - タスク 1.1: インポートの修正
   - タスク 1.2: コンポーネントの置き換え

2. Phase 2: 動作確認
   - タスク 2.1: ログアウト機能の確認
   - タスク 2.2: ログイン機能の確認
   - タスク 2.3: UIデザインの確認

3. Phase 3: テストの確認と修正
   - タスク 3.1: 既存テストの確認
   - タスク 3.2: テストの修正（必要に応じて）

4. Phase 4: 最終確認
   - タスク 4.1: 受け入れ基準の確認
   - タスク 4.2: コードレビュー

## 注意事項

### 実装時の注意
- `signIn`と`signOut`のインポートを削除する際、他で使用されていないことを確認する
- `Button`のインポートを削除する際、他で使用されていないことを確認する
- `session?.user ?? null`の型が`AuthButtons`コンポーネントの`user`プロップの型と一致することを確認する
- UIデザインが崩れる可能性があるが、これは許容する（要件定義書の「UIデザインの調整は範囲外」に従う）

### テストの修正時の注意
- テストの修正が必要な場合は、ユーザーに修正内容の許可を取ること（CLAUDE.local.mdのルールに従う）
- 既存のテストを変更する場合は、変更内容を明確に説明する

### 動作確認時の注意
- ログアウト機能とログイン機能の両方を確認する
- レスポンシブレイアウトが正常に動作することを確認する（小画面と大画面）
- UIデザインが画面内のログアウトボタンと完全に同じになっていることを確認する

## 参考情報

### 関連ファイル
- `client/components/layout/navbar.tsx`: 修正対象ファイル
- `client/components/auth/auth-buttons.tsx`: 使用するコンポーネント
- `client/lib/actions/auth-actions.ts`: 認証アクション（`AuthButtons`内で使用）
- `client/app/page.tsx`: `AuthButtons`の使用例

### 関連ドキュメント
- 要件定義書: `.kiro/specs/0081-header-logout/requirements.md`
- 設計書: `.kiro/specs/0081-header-logout/design.md`
- 関連Issue: https://github.com/taku-o/go-webdb-template/issues/166
