# Auth0直接ログイン対応の実装タスク一覧

## 概要
Auth0直接ログイン対応の実装を段階的に進めるためのタスク一覧。要件定義書と設計書に基づき、実装可能な粒度でタスクを分解。

## 実装フェーズ

### Phase 1: コード変更

#### - [ ] タスク 1.1: client/app/page.tsxの変更
**目的**: ホームページのログインボタンから直接Auth0の認証画面に遷移するように変更

**作業内容**:
- `client/app/page.tsx`を開く
- 112行目付近の`await signIn()`を`await signIn('auth0')`に変更
- 構文エラーがないことを確認
- TypeScriptの型エラーがないことを確認

**受け入れ基準**:
- `client/app/page.tsx`の`signIn()`呼び出しが`signIn('auth0')`に変更されている
- コードの構文エラーがない
- TypeScriptの型エラーがない

_Requirements: 3.2.1, 6.1, Design: Step 1_

---

#### - [ ] タスク 1.2: client/components/layout/navbar.tsxの変更
**目的**: ナビゲーションバーのログインボタンから直接Auth0の認証画面に遷移するように変更

**作業内容**:
- `client/components/layout/navbar.tsx`を開く
- 44行目付近の`await signIn()`を`await signIn('auth0')`に変更
- 構文エラーがないことを確認
- TypeScriptの型エラーがないことを確認

**受け入れ基準**:
- `client/components/layout/navbar.tsx`の`signIn()`呼び出しが`signIn('auth0')`に変更されている
- コードの構文エラーがない
- TypeScriptの型エラーがない

_Requirements: 3.2.2, 6.1, Design: Step 2_

---

### Phase 2: 動作確認

#### - [ ] タスク 2.1: ホームページのログインフローの確認
**目的**: ホームページのログインボタンから直接Auth0の認証画面に遷移することを確認

**作業内容**:
- 開発サーバーを起動
- ホームページ（`client/app/page.tsx`）にアクセス
- ログインボタンをクリック
- NextAuth.jsのデフォルトサインインページ（`/api/auth/signin`）が表示されないことを確認
- 直接Auth0の認証画面に遷移することを確認
- 認証成功後、適切にリダイレクトされることを確認

**受け入れ基準**:
- ログインボタンをクリックした際に、NextAuth.jsのデフォルトサインインページが表示されない
- ログインボタンをクリックした際に、直接Auth0の認証画面に遷移する
- 認証成功後、適切にリダイレクトされる

_Requirements: 3.3, 6.2, Design: Step 3, 手動テスト 1_

---

#### - [ ] タスク 2.2: ナビゲーションバーのログインフローの確認
**目的**: ナビゲーションバーのログインボタンから直接Auth0の認証画面に遷移することを確認

**作業内容**:
- 開発サーバーを起動（タスク2.1で起動済みの場合はそのまま使用）
- ナビゲーションバー（`client/components/layout/navbar.tsx`）のログインボタンをクリック
- NextAuth.jsのデフォルトサインインページ（`/api/auth/signin`）が表示されないことを確認
- 直接Auth0の認証画面に遷移することを確認
- 認証成功後、適切にリダイレクトされることを確認

**受け入れ基準**:
- ログインボタンをクリックした際に、NextAuth.jsのデフォルトサインインページが表示されない
- ログインボタンをクリックした際に、直接Auth0の認証画面に遷移する
- 認証成功後、適切にリダイレクトされる

_Requirements: 3.3, 6.2, Design: Step 3, 手動テスト 2_

---

#### - [ ] タスク 2.3: 既存認証機能の確認
**目的**: 既存の認証機能（ログアウト、セッション管理など）が正常に動作することを確認

**作業内容**:
- ログアウト機能が正常に動作することを確認
- セッション管理が正常に動作することを確認
- ページリロード後もセッションが維持されることを確認

**受け入れ基準**:
- 既存の認証機能（ログアウト、セッション管理など）が正常に動作する
- ページリロード後もセッションが維持される

_Requirements: 6.2, Design: 手動テスト 3_

---

### Phase 3: テスト実行

#### - [ ] タスク 3.1: 既存テストの実行と確認
**目的**: 既存のテストが全て成功することを確認し、新しいテストエラーが発生していないことを確認

**作業内容**:
- 既存の単体テストを実行
- 既存の統合テストを実行
- 既存のE2Eテスト（Playwright）を実行
- すべてのテストが成功することを確認
- 新しいテストエラーが発生していないことを確認

**受け入れ基準**:
- 既存のテストが全て成功する
- 新しいテストエラーが発生していない

_Requirements: 6.3, Design: Step 4, Testing Strategy_

---

## 受け入れ基準の確認

### コード変更
- [ ] `client/app/page.tsx`の`signIn()`呼び出しが`signIn('auth0')`に変更されている
- [ ] `client/components/layout/navbar.tsx`の`signIn()`呼び出しが`signIn('auth0')`に変更されている
- [ ] コードの構文エラーがない
- [ ] TypeScriptの型エラーがない

### 動作確認
- [ ] ログインボタンをクリックした際に、NextAuth.jsのデフォルトサインインページが表示されない
- [ ] ログインボタンをクリックした際に、直接Auth0の認証画面に遷移する
- [ ] 認証成功後、適切にリダイレクトされる
- [ ] 既存の認証機能（ログアウト、セッション管理など）が正常に動作する
- [ ] ページリロード後もセッションが維持される

### テスト
- [ ] 既存のテストが全て成功する
- [ ] 新しいテストエラーが発生していない

## 実装上の注意事項

### プロバイダーIDの確認
- NextAuth.jsの設定（`client/auth.ts`）で定義されているAuth0プロバイダーのIDが`'auth0'`であることを確認済み
- `signIn('auth0')`で正しく動作する

### 変更の適用
- 2つのファイルで同じ変更を適用する
- 変更は単純な関数呼び出しの引数追加のみ

### エラーハンドリング
- 既存のエラーハンドリングに影響を与えない
- NextAuth.jsのエラーハンドリングは既存のまま動作する

## 参考情報

### 関連ドキュメント
- 要件定義書: `.kiro/specs/0067-auth0direct/requirements.md`
- 設計書: `.kiro/specs/0067-auth0direct/design.md`
- NextAuth.js公式ドキュメント: `signIn()`関数の使用方法
- `docs/Partner-Idp-Auth0-Login.md`: Auth0設定手順

### 関連Issue
- https://github.com/taku-o/go-webdb-template/issues/138: 本実装の元となったIssue

### 技術スタック
- **NextAuth.js**: 認証ライブラリ
- **Auth0**: 認証プロバイダー
- **Next.js**: フレームワーク
- **TypeScript**: 型安全性を提供
