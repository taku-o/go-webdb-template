# client2アプリをclientに移行する要件定義書

## 1. 概要

### 1.1 プロジェクト情報
- **プロジェクト名**: go-webdb-template
- **Feature名**: 0065-client2-fix
- **作成日**: 2026-01-27
- **関連Issue**: https://github.com/taku-o/go-webdb-template/issues/134

### 1.2 目的
既存の`client`アプリケーションを削除し、`client2`アプリケーションを`client`にリネームして移行を完了する。これにより、NextAuth (Auth.js) v5とshadcn/uiを活用したモダンな実装が正式なクライアントアプリケーションとして使用される。

### 1.3 スコープ
- 既存の`client`ディレクトリの削除
- `client2`ディレクトリを`client`にリネーム
- 各ドキュメントの`client2`への言及を`client`に更新
- `docs/Temp-Client2.md`の内容を適切なドキュメントに統合
- `docs/Temp-Client2.md`の削除
- Docker Compose設定ファイルの更新（`docker-compose.client.yml`など）
- README.mdの更新

**本実装の範囲外**:
- 機能の追加・変更（既存のclient2アプリの機能をそのまま使用）
- バックエンドAPIの変更
- データベース構造の変更

## 2. 背景・現状分析

### 2.1 既存のclientアプリの状況
- **技術スタック**: Next.js 14+ (App Router)、Auth0、カスタムUI
- **状態**: 既に`client2`アプリに機能が移植済み（0064-client2-implで完了）
- **必要性**: 移行が完了したため、旧`client`アプリは不要

### 2.2 client2アプリの状況
- **技術スタック**: Next.js 14+ (App Router)、NextAuth (Auth.js) v5、shadcn/ui
- **状態**: 既存の`client`アプリの全機能が移植済み
- **機能**: 認証、ユーザー管理、投稿管理、メール送信、動画アップロード、ジョブキューなど
- **テスト**: E2Eテスト、統合テスト、単体テストが実装済み

### 2.3 移行の必要性
- `client2`アプリが正式なクライアントアプリケーションとして使用される
- プロジェクト構造を簡素化し、混乱を避ける
- ドキュメントを最新の状態に更新する

## 3. 機能要件

### 3.1 Phase 1: ディレクトリの移行

#### 3.1.1 既存clientディレクトリの削除
- **目的**: 不要になった既存の`client`ディレクトリを削除する
- **実装内容**:
  - `client/`ディレクトリ全体を削除
  - 削除前に、必要に応じてバックアップを取得（Gitで管理されているため、必要に応じて履歴から復元可能）

#### 3.1.2 client2ディレクトリのリネーム
- **目的**: `client2`ディレクトリを`client`にリネームする
- **実装内容**:
  - `client2/`ディレクトリを`client/`にリネーム
  - ディレクトリ内のファイル・コード内の`client2`への参照は変更不要（ディレクトリ名のみ変更）

### 3.2 Phase 2: ドキュメントの更新

#### 3.2.1 README.mdの更新
- **目的**: README.mdの`client`への言及を最新の状態に更新する
- **実装内容**:
  - セットアップ手順の`cd client`セクションを確認・更新
  - クライアント起動手順の確認・更新
  - `client2`への言及があれば`client`に変更

#### 3.2.2 docs/Temp-Client2.mdの内容統合
- **目的**: `docs/Temp-Client2.md`の内容を適切なドキュメントに統合する
- **実装内容**:
  - `docs/Temp-Client2.md`の内容を確認
  - セットアップ手順はREADME.mdに統合（既存のセットアップ手順と重複する場合は、より詳細な方を採用）
  - 技術スタック、機能説明、ディレクトリ構造などの情報を適切なドキュメントに統合
  - 既存のドキュメントと重複する内容は、より詳細で正確な方を採用

#### 3.2.3 その他ドキュメントの更新
- **目的**: 他のドキュメントファイルで`client2`や`client`への言及を確認・更新する
- **実装内容**:
  - `docs/Partner-Idp-Auth0-Login.md`の確認・更新
    - **重要**: Auth0のコールバックURL設定を更新する必要がある
    - 旧clientアプリ（Auth0直接使用）: `http://localhost:3000/auth/callback`
    - client2アプリ（NextAuth使用）: `http://localhost:3000/api/auth/callback/auth0`
    - セクション5.1「開発環境用のコールバックURL設定」のコールバックURLを`/api/auth/callback/auth0`に更新
    - 各環境のURL一覧テーブルも同様に更新
  - `docs/Project-Structure.md`の確認・更新
  - `docs/Testing.md`の確認・更新
  - `docs/Docker.md`の確認・更新
  - `docs/Release-Check.md`の確認・更新
  - `docs/API.md`の確認・更新
  - その他、`client2`や`client`への言及があるドキュメントを確認・更新

#### 3.2.4 docs/Temp-Client2.mdの削除
- **目的**: 移行完了後、一時的なドキュメントを削除する
- **実装内容**:
  - `docs/Temp-Client2.md`を削除
  - 削除前に、内容が適切なドキュメントに統合されていることを確認

### 3.3 Phase 3: 設定ファイルの更新

#### 3.3.1 Docker Compose設定の更新
- **目的**: Docker Compose設定ファイルで`client`ディレクトリを参照するように更新する
- **実装内容**:
  - `docker-compose.client.yml`の確認・更新
  - `context: ./client`が正しく設定されていることを確認
  - その他、Docker Composeファイルで`client2`への参照があれば`client`に変更

#### 3.3.2 その他設定ファイルの更新
- **目的**: その他の設定ファイルで`client2`への参照があれば更新する
- **実装内容**:
  - `.gitignore`の確認（`client/`と`client2/`の両方が記載されている場合は、`client2/`を削除）
  - その他、設定ファイルで`client2`への参照を確認・更新

### 3.4 Phase 4: コード内の参照の確認

#### 3.4.1 コード内のclient2参照の確認
- **目的**: コード内で`client2`への参照が残っていないか確認する
- **実装内容**:
  - `client/`ディレクトリ内のコードで`client2`への参照を検索
  - 設定ファイル、コメント、ドキュメント内の`client2`への参照を確認
  - 必要に応じて更新（ただし、ディレクトリ名の変更のみで、コード内の参照は通常変更不要）

## 4. 非機能要件

### 4.1 安全性
- **削除前の確認**: `client`ディレクトリを削除する前に、`client2`アプリが正常に動作することを確認する
- **バックアップ**: Gitで管理されているため、必要に応じて履歴から復元可能
- **段階的な移行**: 各フェーズを順次実行し、各段階で動作確認を行う

### 4.2 互換性
- **既存機能の維持**: `client2`アプリの既存機能がすべて正常に動作することを確認する
- **API互換性**: バックエンドAPIとの互換性を維持する
- **環境変数**: 環境変数の設定が正しく動作することを確認する

### 4.3 ドキュメントの整合性
- **一貫性**: すべてのドキュメントで`client`への言及が一貫していることを確認する
- **正確性**: ドキュメントの内容が最新の実装と一致していることを確認する
- **完全性**: 必要な情報がすべて適切なドキュメントに記載されていることを確認する

## 5. 制約事項

### 5.1 技術的制約
- **Git履歴**: 既存の`client`ディレクトリの履歴はGitで管理されているため、必要に応じて参照可能
- **依存関係**: `client2`アプリの依存関係が正しく動作することを確認する必要がある
- **環境変数**: 環境変数の設定が正しく動作することを確認する必要がある

### 5.2 実装上の制約
- **ディレクトリ名の変更**: `client2`を`client`にリネームする際、大文字小文字や特殊文字に注意する
- **パスの更新**: 相対パスや絶対パスで`client2`を参照している箇所があれば更新する必要がある
- **シンボリックリンク**: シンボリックリンクで`client2`を参照している箇所があれば更新する必要がある

### 5.3 動作環境
- **ローカル環境**: ローカル環境で開発サーバーが正常に起動することを確認する
- **Docker環境**: Docker環境でコンテナが正常に起動することを確認する
- **テスト環境**: テストが正常に実行されることを確認する

## 6. 受け入れ基準

### 6.1 Phase 1: ディレクトリの移行
- [ ] 既存の`client`ディレクトリが削除されている
- [ ] `client2`ディレクトリが`client`にリネームされている
- [ ] リネーム後、開発サーバーが正常に起動する

### 6.2 Phase 2: ドキュメントの更新
- [ ] README.mdが更新され、`client`への言及が最新の状態になっている
- [ ] `docs/Temp-Client2.md`の内容が適切なドキュメントに統合されている
- [ ] その他ドキュメントで`client2`への言及が`client`に更新されている
- [ ] `docs/Partner-Idp-Auth0-Login.md`のAuth0コールバックURL設定が更新されている（`/auth/callback` → `/api/auth/callback/auth0`）
- [ ] `docs/Temp-Client2.md`が削除されている

### 6.3 Phase 3: 設定ファイルの更新
- [ ] `docker-compose.client.yml`が更新され、`client`ディレクトリを参照している
- [ ] その他設定ファイルで`client2`への参照が`client`に更新されている

### 6.4 Phase 4: コード内の参照の確認
- [ ] コード内で`client2`への不適切な参照がないことを確認
- [ ] すべてのテストが正常に実行される

### 6.5 最終確認
- [ ] 開発サーバーが正常に起動する
- [ ] すべてのページが正常に表示される
- [ ] 認証機能が正常に動作する
- [ ] API呼び出しが正常に動作する
- [ ] E2Eテストが正常に実行される
- [ ] 統合テストが正常に実行される
- [ ] 単体テストが正常に実行される
- [ ] Docker環境でコンテナが正常に起動する

## 7. 影響範囲

### 7.1 変更が必要なファイル・ディレクトリ

#### 削除が必要なディレクトリ
- `client/`: 既存のclientアプリディレクトリ（全体を削除）

#### リネームが必要なディレクトリ
- `client2/` → `client/`: client2アプリディレクトリをclientにリネーム

#### 更新が必要なファイル
- `README.md`: セットアップ手順、クライアント起動手順の更新
- `docs/Temp-Client2.md`: 内容を統合後、削除
- `docs/Partner-Idp-Auth0-Login.md`: 
  - `client2`への言及があれば`client`に更新
  - **重要**: Auth0のコールバックURL設定を更新（`/auth/callback` → `/api/auth/callback/auth0`）
  - セクション5.1「開発環境用のコールバックURL設定」のコールバックURLを`/api/auth/callback/auth0`に更新
  - 各環境のURL一覧テーブルも同様に更新
- `docs/Project-Structure.md`: `client2`への言及があれば`client`に更新
- `docs/Testing.md`: `client2`への言及があれば`client`に更新
- `docs/Docker.md`: `client2`への言及があれば`client`に更新
- `docs/Release-Check.md`: `client2`への言及があれば`client`に更新
- `docs/API.md`: `client2`への言及があれば`client`に更新
- `docker-compose.client.yml`: `context: ./client`が正しく設定されていることを確認
- `.gitignore`: `client2/`への参照があれば削除

### 7.2 既存機能への影響
- **既存のclient2アプリ**: ディレクトリ名が`client`に変更されるが、機能への影響はない
- **既存のバックエンドAPI**: 影響なし（APIエンドポイントは変更されない）
- **既存のデータベース**: 影響なし（データ構造は変更されない）
- **既存のテスト**: ディレクトリ名の変更に伴い、パスの更新が必要な場合がある

## 8. 実装上の注意事項

### 8.1 ディレクトリの削除・リネーム
- **削除前の確認**: `client`ディレクトリを削除する前に、`client2`アプリが正常に動作することを確認する
- **リネームの順序**: 先に`client2`を`client`にリネームしてから、既存の`client`を削除する（既存の`client`が存在する場合は、先に削除または別名にリネーム）
- **Git管理**: Gitで管理されているため、履歴から復元可能だが、削除前に動作確認を行う

### 8.2 ドキュメントの統合
- **重複の確認**: `docs/Temp-Client2.md`の内容と既存ドキュメントの重複を確認し、より詳細で正確な方を採用する
- **情報の整理**: セットアップ手順、技術スタック、機能説明などを適切なドキュメントに分類して統合する
- **一貫性の確保**: すべてのドキュメントで`client`への言及が一貫していることを確認する
- **Auth0コールバックURLの更新**: `docs/Partner-Idp-Auth0-Login.md`のコールバックURL設定をNextAuth対応の`/api/auth/callback/auth0`に更新する（旧clientの`/auth/callback`から変更）

### 8.3 設定ファイルの更新
- **パスの確認**: 相対パスや絶対パスで`client2`を参照している箇所を確認し、`client`に更新する
- **環境変数**: 環境変数の設定が正しく動作することを確認する
- **Docker設定**: Docker Compose設定が正しく動作することを確認する

### 8.4 テストの確認
- **テストパス**: テストファイル内のパス参照を確認し、必要に応じて更新する
- **テスト実行**: すべてのテストが正常に実行されることを確認する
- **E2Eテスト**: E2Eテストが正常に実行されることを確認する

## 9. 参考情報

### 9.1 関連ドキュメント
- `.kiro/specs/0064-client2-impl/`: client2アプリへの機能移植の要件定義書
- `.kiro/specs/0063-client2/`: client2アプリ作成の要件定義書
- `docs/Temp-Client2.md`: client2アプリのセットアップと機能説明（統合対象）
- `README.md`: プロジェクトのメインドキュメント（更新対象）

### 9.2 関連Issue
- https://github.com/taku-o/go-webdb-template/issues/134: 本要件定義書の元となったIssue

### 9.3 技術スタック
- **フレームワーク**: Next.js 14+ (App Router)
- **言語**: TypeScript 5+
- **UIコンポーネント**: shadcn/ui
- **認証**: NextAuth (Auth.js) v5
- **スタイリング**: Tailwind CSS
- **テスト**: Playwright (E2E), Jest (単体・統合)

### 9.4 実装の流れ
1. Phase 1: ディレクトリの移行（削除・リネーム）
2. Phase 2: ドキュメントの更新（README.md、その他ドキュメント、Temp-Client2.mdの統合・削除）
3. Phase 3: 設定ファイルの更新（Docker Compose、その他設定ファイル）
4. Phase 4: コード内の参照の確認（テスト、その他コード）
5. 最終確認（動作確認、テスト実行）

### 9.5 依存関係
- Phase 2はPhase 1完了後に開始
- Phase 3はPhase 1完了後に開始（Phase 2と並行可能）
- Phase 4はPhase 1完了後に開始（Phase 2、Phase 3と並行可能）
- 最終確認はすべてのPhase完了後に実施
